<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clipboard Manager - Settings</title>
    <link rel="stylesheet" href="settings.css">
</head>
<body>
    <div class="settings-container">
        <div class="settings-header">
            <h1>Settings</h1>
            <p>Clipboard Manager v1.0.0</p>
        </div>

        <div class="settings-section">
            <h2 class="section-title">Layout</h2>
            
            <div class="setting-item">
                <div class="setting-label">
                    <h3>Window Position</h3>
                    <p>Choose where the clipboard manager appears on screen</p>
                </div>
                <div class="setting-control">
                    <select id="position-selector">
                        <option value="left">Left Edge</option>
                        <option value="right">Right Edge</option>
                        <option value="top">Top Edge</option>
                        <option value="bottom">Bottom Edge</option>
                        <option value="window">Free Window</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="section-title">Appearance</h2>
            
            <div class="setting-item">
                <div class="setting-label">
                    <h3>Theme</h3>
                    <p>Choose between light and dark mode</p>
                </div>
                <div class="setting-control">
                    <select id="theme-selector">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="section-title">Storage</h2>
            
            <div class="setting-item">
                <div class="setting-label">
                    <h3>Clear All Clipboard Data</h3>
                    <p>Permanently delete all clipboard history and pinned items</p>
                </div>
                <div class="setting-control">
                    <button class="btn btn-danger" id="clear-all-data">Clear All Data</button>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="section-title">About</h2>
            
            <div class="setting-item">
                <div class="setting-label">
                    <h3>Keyboard Shortcut</h3>
                    <p>‚åò‚áßV to show/hide clipboard manager</p>
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <h3>Database Location</h3>
                    <p>Stored in your user data directory</p>
                </div>
                <div class="setting-control">
                    <button class="btn btn-secondary" id="open-data-folder">Open Folder</button>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="section-title">Application</h2>
            
            <div class="setting-item">
                <div class="setting-label">
                    <h3>Quit Clipboard Manager</h3>
                    <p>Close the application completely and stop clipboard monitoring</p>
                </div>
                <div class="setting-control">
                    <button class="btn btn-quit" id="quit-app">Quit Application</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üîß Settings JavaScript loaded');
        
        const { ipcRenderer } = require('electron');
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üîß DOM loaded');
            
            // Load current theme and position
            try {
                const currentTheme = await ipcRenderer.invoke('get-current-theme');
                console.log('üé® Current theme loaded:', currentTheme);
                document.getElementById('theme-selector').value = currentTheme;
                applyTheme(currentTheme);

                const currentPosition = await ipcRenderer.invoke('get-current-position');
                console.log('üìç Current position loaded:', currentPosition);
                document.getElementById('position-selector').value = currentPosition;
            } catch (error) {
                console.error('‚ùå Failed to load current settings:', error);
            }
            
            // Theme selector handler
            const themeSelector = document.getElementById('theme-selector');
            if (themeSelector) {
                console.log('‚úÖ Theme selector found');
                
                themeSelector.addEventListener('change', async function(e) {
                    const selectedTheme = e.target.value;
                    console.log('üé® Theme changed to:', selectedTheme);
                    
                    try {
                        const result = await ipcRenderer.invoke('set-theme', selectedTheme);
                        console.log('‚úÖ Theme set result:', result);
                        applyTheme(selectedTheme);
                    } catch (error) {
                        console.error('‚ùå Failed to set theme:', error);
                    }
                });
                
                console.log('‚úÖ Theme event listener attached');
            } else {
                console.error('‚ùå Theme selector not found');
            }

            // Position selector handler
            const positionSelector = document.getElementById('position-selector');
            if (positionSelector) {
                console.log('‚úÖ Position selector found');
                
                positionSelector.addEventListener('change', async function(e) {
                    const selectedPosition = e.target.value;
                    console.log('üìç Position changed to:', selectedPosition);
                    
                    try {
                        const result = await ipcRenderer.invoke('set-window-position', selectedPosition);
                        console.log('‚úÖ Position set result:', result);
                    } catch (error) {
                        console.error('‚ùå Failed to set position:', error);
                    }
                });
                
                console.log('‚úÖ Position event listener attached');
            } else {
                console.error('‚ùå Position selector not found');
            }

            // Listen for theme changes from other windows
            ipcRenderer.on('theme-changed', (event, theme) => {
                console.log('üì® Theme changed message received:', theme);
                applyTheme(theme);
                document.getElementById('theme-selector').value = theme;
            });

            // Clear All Data button
            document.getElementById('clear-all-data').addEventListener('click', async () => {
                if (confirm('Are you sure you want to clear all clipboard data? This cannot be undone.')) {
                    try {
                        console.log('üßπ Clearing all clipboard data...');
                        await ipcRenderer.invoke('clear-clipboard-history');
                        alert('All clipboard data has been cleared.');
                        console.log('‚úÖ Clipboard data cleared successfully');
                    } catch (error) {
                        console.error('‚ùå Failed to clear clipboard data:', error);
                        alert('Failed to clear clipboard data.');
                    }
                }
            });

            // Open Data Folder button
            document.getElementById('open-data-folder').addEventListener('click', async () => {
                try {
                    console.log('üìÅ Opening data folder...');
                    await ipcRenderer.invoke('open-data-folder');
                    console.log('‚úÖ Data folder opened');
                } catch (error) {
                    console.error('‚ùå Failed to open data folder:', error);
                }
            });

            // Quit Application button
            document.getElementById('quit-app').addEventListener('click', async () => {
                if (confirm('Are you sure you want to quit Clipboard Manager? This will stop clipboard monitoring.')) {
                    try {
                        console.log('üíÄ Quitting application...');
                        
                        // Send quit signal to main process
                        const result = await ipcRenderer.invoke('quit-application');
                        console.log('‚úÖ Quit signal sent, result:', result);
                        
                        // Small delay to ensure the message is processed
                        setTimeout(() => {
                            console.log('üîÑ Backup quit attempt...');
                            // Backup method - tell main process we're really quitting
                            ipcRenderer.send('force-quit');
                        }, 100);
                        
                    } catch (error) {
                        console.error('‚ùå Failed to quit application:', error);
                        // Fallback - try to quit anyway
                        try {
                            ipcRenderer.send('force-quit');
                        } catch (fallbackError) {
                            console.error('‚ùå Fallback quit also failed:', fallbackError);
                        }
                    }
                }
            });
        });

        function applyTheme(theme) {
            console.log('üé® Applying theme:', theme);
            document.documentElement.setAttribute('data-theme', theme);
        }
    </script>
</body>
</html>